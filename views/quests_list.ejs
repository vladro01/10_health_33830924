<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Quests – LevelUp</title>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class="page">
    <header class="top-bar">
      <div class="top-bar-left">
        <div class="logo-dot"></div>
        <span class="app-name">LevelUp</span>
        <span class="app-subtitle">Health Quests</span>
      </div>

      <nav class="nav-links">
        <a href="/" class="nav-link">Dashboard</a>
        <a href="/quests" class="nav-link nav-link-active">Quests</a>
        <a href="/search" class="nav-link">Search</a>
        <a href="/weather" class="nav-link">Weather</a>
        <a href="/about" class="nav-link">About</a>
      </nav>

      <div class="user-area">
        <% 
          const loggedIn = (typeof isAuthenticated !== 'undefined' && isAuthenticated) ||
                           (typeof username !== 'undefined' && username);
        %>
        <% if (loggedIn) { %>
          <span class="user-greeting">
            Welcome, <strong><%= typeof username !== 'undefined' ? username : 'user' %></strong>
          </span>
          <a href="/quests/me/logs" class="btn btn-ghost small">My logs</a>
          <% if (typeof username !== 'undefined' && username === 'gold') { %>
            <a href="/users/audit" class="btn btn-ghost small">Audit</a>
          <% } %>
          <a href="/users/logout" class="btn btn-outline small">Logout</a>
        <% } else { %>
          <a href="/users/login" class="btn btn-primary small">Login</a>
        <% } %>
      </div>
    </header>

    <main class="content-wide">
      <section class="card-page">
        <p class="eyebrow">Quest library</p>
        <h1 class="page-title">All quests</h1>
        <p class="page-subtitle">
          Filter by difficulty, outdoor quests, or search by name.
        </p>

        <form method="get" action="/quests" class="stack-vertical">
          <div class="form-row">
            <label>Search by name</label>
            <input
              type="text"
              name="search"
              placeholder="e.g. Abs, jog, HIIT..."
              value="<%= typeof searchTerm !== 'undefined' ? searchTerm : '' %>"
            />
          </div>

          <div class="form-row">
            <label>Difficulty</label>
            <select name="difficulty">
              <option value="">Any</option>
              <option value="easy"   <%= selectedDifficulty === 'easy'   ? 'selected' : '' %>>Easy</option>
              <option value="medium" <%= selectedDifficulty === 'medium' ? 'selected' : '' %>>Medium</option>
              <option value="hard"   <%= selectedDifficulty === 'hard'   ? 'selected' : '' %>>Hard</option>
            </select>
          </div>

          <div class="form-row">
            <label>
              <input
                type="checkbox"
                name="outdoor"
                value="1"
                <%= outdoorOnly ? 'checked' : '' %>
              />
              Outdoor quests only
            </label>
          </div>

          <button type="submit" class="btn btn-primary">Apply filters</button>
        </form>

        <% if (!quests || quests.length === 0) { %>
          <p class="card-text" style="margin-top: 16px;">
            No quests found with these filters. Try clearing them or searching for something else.
          </p>
        <% } else { %>
          <table class="table-soft" style="margin-top: 18px;">
            <thead>
              <tr>
                <th>Name</th>
                <th>Outdoor</th>
                <th>Difficulty</th>
                <th>Target time</th>
              </tr>
            </thead>
            <tbody>
              <% quests.forEach(function (q) { %>
                <tr>
                  <td>
                    <a href="/quests/<%= q.id %>"><%= q.name %></a>
                  </td>
                  <td><%= q.is_outdoor ? 'Yes' : 'No' %></td>
                  <td><span class="badge"><%= q.difficulty %></span></td>
                  <td><%= q.target_minutes || '—' %> min</td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        <% } %>
      </section>
    </main>
  </body>
</html>